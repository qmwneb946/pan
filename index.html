<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GitHub 网盘</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
    <script src="https://kit.fontawesome.com/a076d05399.js"></script>
    <style>
        body { padding: 20px; max-width: 800px; margin: auto; }
        .file-list { list-style: none; padding: 0; }
        .file-list li { padding: 10px; border-bottom: 1px solid #ddd; display: flex; align-items: center; }
        .file-list i { margin-right: 10px; }
        .back-btn { display: none; }
    </style>
</head>
<body>

    <h2 class="text-center">📂 我的 GitHub 网盘</h2>
    <button class="btn btn-secondary back-btn" onclick="goBack()">⬅ 返回上一级</button>
    <ul class="file-list" id="file-list">正在加载文件...</ul>

    <script>
        const repo = "qmwneb946/pan"; // 修改为你的仓库
        const branch = "main"; // 仓库分支
        let currentPath = "files"; // 初始目录

        async function fetchFiles(path) {
            const url = `https://api.github.com/repos/${repo}/contents/${path}?ref=${branch}`;
            try {
                let response = await fetch(url);
                let files = await response.json();

                let list = document.getElementById("file-list");
                list.innerHTML = ""; // 清空内容

                // 如果当前目录不是根目录，显示返回按钮
                if (path !== "files") {
                    document.querySelector(".back-btn").style.display = "block";
                } else {
                    document.querySelector(".back-btn").style.display = "none";
                }

                files.forEach(file => {
                    let li = document.createElement("li");
                    let link = document.createElement("a");
                    link.style = "text-decoration: none; color: black;";
                    
                    if (file.type === "dir") {
                        // 进入文件夹
                        link.href = "#";
                        link.onclick = () => { currentPath = file.path; fetchFiles(file.path); };
                        link.innerHTML = `<i class="fas fa-folder text-warning"></i> ${file.name}`;
                    } else {
                        // 下载文件
                        link.href = file.download_url;
                        link.target = "_blank";
                        let sizeKB = (file.size / 1024).toFixed(1);
                        link.innerHTML = `<i class="fas fa-file text-primary"></i> ${file.name} <span class="text-muted">(${sizeKB} KB)</span>`;
                    }

                    li.appendChild(link);
                    list.appendChild(li);
                });
            } catch (error) {
                document.getElementById("file-list").innerText = "无法加载文件列表";
            }
        }

        function goBack() {
            let parts = currentPath.split("/");
            parts.pop();
            currentPath = parts.length > 1 ? parts.join("/") : "files";
            fetchFiles(currentPath);
        }

        fetchFiles(currentPath);
    </script>

</body>
</html>
