name: Generate GitHub Pages UI

on:
    push:
        branches:
            - main

jobs:
    build:
        runs-on: ubuntu-latest

        steps:
            - name: Checkout repository
              uses: actions/checkout@v2

            - name: Setup Node.js
              uses: actions/setup-node@v2
              with:
                  node-version: '14'

            - name: Install dependencies
              run: npm install

            - name: Generate file list and UI
              run: |
                  mkdir -p public
                  find . -type d -not -path "./public/*" -exec sh -c 'mkdir -p public/{} && ls -1 {} > public/{}/index.html' \;
                  find . -type f -not -path "./public/*" -exec sh -c 'echo "<a href=\"{}\">{}</a><br>" >> public/$(dirname {})/index.html' \;

            - name: Add Monaco Editor
              run: |

            - name: Create index.html
              run: |
                  echo '<!DOCTYPE html><html><head><meta charset="UTF-8"><title>File Browser</title><script src="vs/loader.js"></script><script>require.config({ paths: { "vs": "vs" }});require(["vs/editor/editor.main"], function() { window.monaco = monaco; });</script></head><body><h1>File Browser</h1><div id="file-list"></div><div id="editor" style="width:800px;height:600px;"></div><script>function loadFile(file) { fetch(file).then(response => response.text()).then(text => { monaco.editor.create(document.getElementById("editor"), { value: text, language: "plaintext" }); }); } document.querySelectorAll("a").forEach(a => { a.addEventListener("click", function(e) { e.preventDefault(); loadFile(this.href); }); });</script></body></html>' > public/index.html

            - name: Deploy to GitHub Pages
              uses: peaceiris/actions-gh-pages@v3
              with:
                  github_token: ${{ secrets.GITHUB_TOKEN }}
                  publish_dir: ./public
